<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<head th:replace="~{fragments/layout :: head('Learning - MindWell')}">
</head>

<body class="bg-background-light dark:bg-background-dark font-display text-slate-700 dark:text-slate-300 antialiased">
    <div class="flex h-screen">
        <div th:replace="~{fragments/sidebar-student :: sidebar('learning')}"></div>

        <main class="flex-1 p-8 overflow-y-auto">
            <header class="mb-8">
                <h2 class="text-3xl font-bold text-slate-900 dark:text-white mb-2">Learning Modules</h2>
                <p class="text-slate-500 dark:text-slate-400">Explore and master mental health topics at your own pace</p>
            </header>

            <!-- Empty State -->
            <div th:if="${modules == null or modules.isEmpty()}" class="text-center py-12">
                <span class="material-symbols-outlined text-6xl text-slate-300 dark:text-slate-600 block mb-4">school</span>
                <h3 class="text-xl font-semibold text-slate-600 dark:text-slate-300 mb-2">No Modules Available</h3>
                <p class="text-slate-500 dark:text-slate-400">Your counselor hasn't created any learning modules yet. Check back soon!</p>
            </div>

            <!-- Modules Grid -->
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6" th:if="${modules != null and !modules.isEmpty()}">
                <div th:each="module : ${modules}" 
                    class="bg-white dark:bg-slate-900 rounded-xl shadow-md hover:shadow-lg transition-shadow border border-slate-200 dark:border-slate-800 overflow-hidden cursor-pointer group"
                    th:data-module-id="${module.id}">
                    
                    <!-- Module Header with Icon -->
                    <div class="h-32 bg-gradient-to-br from-indigo-500 to-purple-600 p-6 flex items-end relative">
                        <div class="text-4xl">ðŸ“š</div>
                        <!-- Completion Badge -->
                        <div th:if="${progressMap.get(module.id) == 100}" 
                             class="absolute top-4 right-4 bg-green-500 text-white text-xs font-bold px-2 py-1 rounded-full flex items-center gap-1">
                            <span class="material-symbols-outlined text-sm">check_circle</span>
                            Completed
                        </div>
                    </div>

                    <!-- Module Content -->
                    <div class="p-6">
                        <h3 class="text-lg font-semibold text-slate-900 dark:text-white mb-2 group-hover:text-primary transition-colors" 
                            th:text="${module.title}">Module Title</h3>
                        
                        <p class="text-sm text-slate-600 dark:text-slate-400 mb-4 line-clamp-2" 
                            th:text="${module.description != null ? module.description : 'No description available'}">Description</p>

                        <!-- Module Stats -->
                        <div class="flex items-center justify-between text-sm text-slate-500 dark:text-slate-400 mb-4">
                            <div class="flex items-center gap-1">
                                <span class="material-symbols-outlined text-base">play_lesson</span>
                                <span th:text="${module.materials != null ? module.materials.size() : 0} + ' materials'">0 materials</span>
                            </div>
                            <span th:if="${progressMap.get(module.id) == 0}" class="text-xs text-slate-400">Not started</span>
                            <span th:if="${progressMap.get(module.id) > 0 and progressMap.get(module.id) < 100}" class="text-xs text-indigo-600 dark:text-indigo-400 font-medium">In progress</span>
                            <span th:if="${progressMap.get(module.id) == 100}" class="text-xs text-green-600 dark:text-green-400 font-medium">Complete</span>
                        </div>

                        <!-- Progress Bar -->
                        <div class="flex items-center gap-2 mb-4">
                            <div class="flex-1 bg-slate-200 dark:bg-slate-700 rounded-full h-2 overflow-hidden">
                                <div th:class="'h-2 rounded-full transition-all duration-300 ' + (${progressMap.get(module.id) == 100} ? 'bg-green-500' : 'bg-primary')"
                                     th:style="'width: ' + ${progressMap.get(module.id)} + '%'"></div>
                            </div>
                            <span class="text-xs font-medium text-slate-600 dark:text-slate-400" th:text="${progressMap.get(module.id)} + '%'">0%</span>
                        </div>

                        <!-- View Button -->
                        <a th:href="@{/student/learning/module/} + ${module.id}"
                            th:class="'block w-full px-4 py-2 font-medium rounded-lg transition-colors text-center ' + (${progressMap.get(module.id) == 100} ? 'bg-green-600 hover:bg-green-700 text-white' : 'bg-primary text-white hover:bg-indigo-700')"
                            th:text="${progressMap.get(module.id) == 100} ? 'Review Module' : (${progressMap.get(module.id) > 0} ? 'Continue Learning' : 'Start Module')">
                            View Module
                        </a>
                    </div>
                </div>
            </div>
        </main>
    </div>
</body>

</html>