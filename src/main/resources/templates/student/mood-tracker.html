<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<head th:replace="~{fragments/layout :: head('Mood Tracker - MindWell')}">
</head>

<body class="bg-background-light dark:bg-background-dark font-display text-slate-700 dark:text-slate-300 antialiased">
    <div class="flex h-screen">
        <div th:replace="~{fragments/sidebar-student :: sidebar('mood-tracker')}"></div>

        <main class="flex-1 p-8 overflow-y-auto">
            <header class="flex justify-between items-center mb-8">
                <div>
                    <h2 class="text-3xl font-bold text-slate-900 dark:text-white">Mood Tracker</h2>
                    <p class="text-slate-500 dark:text-slate-400 mt-1">Keep a daily record of your emotional well-being.
                    </p>
                </div>
                <div class="flex items-center gap-2">
                    <button
                        class="px-3 py-2 text-sm font-semibold text-slate-600 dark:text-slate-300 bg-white dark:bg-slate-800 border border-slate-300 dark:border-slate-700 rounded hover:bg-slate-50 dark:hover:bg-slate-700 transition-colors">Export
                        Data</button>
                </div>
            </header>

            <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                <!-- Left Column - Mood Input & Stress Test -->
                <div class="lg:col-span-1 space-y-8">
                    <!-- Mood Selection Card -->
                    <div
                        class="bg-white dark:bg-slate-900 p-6 rounded-lg border border-slate-200 dark:border-slate-800 shadow-sm">
                        <h3 class="text-lg font-semibold text-slate-800 dark:text-white mb-1">How are you feeling today?
                        </h3>
                        <p class="text-sm text-slate-500 dark:text-slate-400 mb-6">Select a mood that best describes
                            your current state.</p>
                        <div class="flex justify-between items-center text-slate-500 dark:text-slate-400 text-3xl"
                            id="moodButtons">
                            <button aria-label="Terrible" data-mood="1"
                                class="mood-btn p-2 rounded-full hover:bg-red-100 dark:hover:bg-red-900/50 transition-colors"
                                onclick="selectMood(1, this)">ğŸ˜”</button>
                            <button aria-label="Bad" data-mood="2"
                                class="mood-btn p-2 rounded-full hover:bg-orange-100 dark:hover:bg-orange-900/50 transition-colors"
                                onclick="selectMood(2, this)">ğŸ˜Ÿ</button>
                            <button aria-label="Okay" data-mood="3"
                                class="mood-btn p-2 rounded-full hover:bg-yellow-100 dark:hover:bg-yellow-900/50 transition-colors"
                                onclick="selectMood(3, this)">ğŸ˜</button>
                            <button aria-label="Good" data-mood="4"
                                class="mood-btn p-2 rounded-full hover:bg-teal-100 dark:hover:bg-teal-900/50 transition-colors"
                                onclick="selectMood(4, this)">ğŸ™‚</button>
                            <button aria-label="Great" data-mood="5"
                                class="mood-btn p-2 rounded-full hover:bg-green-100 dark:hover:bg-green-900/50 transition-colors"
                                onclick="selectMood(5, this)">ğŸ˜„</button>
                        </div>
                        <div class="mt-4 flex justify-between text-xs text-slate-400 dark:text-slate-500 px-1">
                            <span>Terrible</span>
                            <span>Great</span>
                        </div>
                        <p id="selectedMoodText" class="text-center text-sm text-primary font-medium mt-4 hidden">
                            Selected: <span id="moodLabel"></span></p>
                        <button id="logMoodBtn"
                            class="mt-6 w-full bg-primary text-white font-semibold py-3 px-4 rounded hover:bg-indigo-700 transition-colors focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary dark:focus:ring-offset-slate-900 disabled:opacity-50 disabled:cursor-not-allowed"
                            onclick="logMood()" disabled>Log Today's Mood</button>
                    </div>

                    <!-- Stress Self-Assessment Card -->
                    <div
                        class="bg-white dark:bg-slate-900 p-6 rounded-lg border border-slate-200 dark:border-slate-800 shadow-sm">
                        <div class="flex items-start justify-between">
                            <div>
                                <h3 class="text-lg font-semibold text-slate-800 dark:text-white">Stress Self-Assessment
                                </h3>
                                <p class="text-sm text-slate-500 dark:text-slate-400 mt-1">Check in on your stress
                                    levels.</p>
                            </div>
                            <span class="material-symbols-outlined text-xl text-amber-500">healing</span>
                        </div>
                        <p class="mt-4 text-sm text-slate-600 dark:text-slate-300">Take a quick, confidential test to
                            understand your current stress levels and get personalized resource recommendations.</p>
                        <button
                            class="mt-6 w-full text-primary font-semibold py-3 px-4 rounded border-2 border-primary hover:bg-indigo-50 dark:hover:bg-indigo-900/30 transition-colors"
                            onclick="document.getElementById('stressModal').classList.remove('hidden')">Start Stress
                            Test</button>
                    </div>
                </div>

                <!-- Right Column - Mood History Chart -->
                <div
                    class="lg:col-span-2 bg-white dark:bg-slate-900 p-6 rounded-lg border border-slate-200 dark:border-slate-800 shadow-sm">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-lg font-semibold text-slate-800 dark:text-white">Your Mood History</h3>
                        <div class="flex items-center gap-2 text-sm">
                            <button
                                class="px-3 py-1.5 rounded bg-indigo-100 dark:bg-indigo-900/60 text-primary font-medium">Week</button>
                            <button
                                class="px-3 py-1.5 rounded text-slate-500 dark:text-slate-400 hover:bg-slate-100 dark:hover:bg-slate-800">Month</button>
                        </div>
                    </div>

                    <!-- Mood Chart -->
                    <div class="h-64 flex items-end justify-between gap-2 px-4 py-6 bg-slate-50 dark:bg-slate-800/50 rounded-lg"
                        id="moodChart">
                        <div class="flex flex-col items-center gap-2 flex-1">
                            <div class="w-full bg-yellow-400 rounded-t-lg transition-all" style="height: 60%"></div>
                            <span class="text-xl">ğŸ˜</span>
                            <span class="text-xs text-slate-500">Mon</span>
                        </div>
                        <div class="flex flex-col items-center gap-2 flex-1">
                            <div class="w-full bg-teal-400 rounded-t-lg transition-all" style="height: 80%"></div>
                            <span class="text-xl">ğŸ™‚</span>
                            <span class="text-xs text-slate-500">Tue</span>
                        </div>
                        <div class="flex flex-col items-center gap-2 flex-1">
                            <div class="w-full bg-green-400 rounded-t-lg transition-all" style="height: 100%"></div>
                            <span class="text-xl">ğŸ˜„</span>
                            <span class="text-xs text-slate-500">Wed</span>
                        </div>
                        <div class="flex flex-col items-center gap-2 flex-1">
                            <div class="w-full bg-teal-400 rounded-t-lg transition-all" style="height: 80%"></div>
                            <span class="text-xl">ğŸ™‚</span>
                            <span class="text-xs text-slate-500">Thu</span>
                        </div>
                        <div class="flex flex-col items-center gap-2 flex-1">
                            <div class="w-full bg-green-400 rounded-t-lg transition-all" style="height: 100%"></div>
                            <span class="text-xl">ğŸ˜„</span>
                            <span class="text-xs text-slate-500">Fri</span>
                        </div>
                        <div class="flex flex-col items-center gap-2 flex-1">
                            <div class="w-full bg-green-400 rounded-t-lg transition-all" style="height: 100%"></div>
                            <span class="text-xl">ğŸ˜„</span>
                            <span class="text-xs text-slate-500">Sat</span>
                        </div>
                        <div class="flex flex-col items-center gap-2 flex-1" id="todayMood">
                            <div class="w-full bg-slate-300 dark:bg-slate-600 rounded-t-lg transition-all border-2 border-dashed border-primary"
                                style="height: 40%"></div>
                            <span class="text-xl">â“</span>
                            <span class="text-xs text-primary font-semibold">Today</span>
                        </div>
                    </div>

                    <!-- Streak Info -->
                    <div class="mt-6 grid grid-cols-3 gap-4">
                        <div class="text-center p-4 bg-slate-50 dark:bg-slate-800 rounded-lg">
                            <p class="text-2xl font-bold text-primary">7</p>
                            <p class="text-sm text-slate-500">Day Streak ğŸ”¥</p>
                        </div>
                        <div class="text-center p-4 bg-slate-50 dark:bg-slate-800 rounded-lg">
                            <p class="text-2xl font-bold text-green-500">4.2</p>
                            <p class="text-sm text-slate-500">Avg. Mood</p>
                        </div>
                        <div class="text-center p-4 bg-slate-50 dark:bg-slate-800 rounded-lg">
                            <p class="text-2xl font-bold text-amber-500">ğŸ˜„</p>
                            <p class="text-sm text-slate-500">Most Common</p>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Stress Test Modal -->
    <div id="stressModal" class="hidden fixed inset-0 bg-black/50 flex items-center justify-center p-4 z-50">
        <div class="bg-white dark:bg-slate-900 rounded-xl w-full max-w-lg max-h-[90vh] overflow-y-auto">
            <div
                class="p-6 border-b border-slate-200 dark:border-slate-800 flex justify-between items-center sticky top-0 bg-white dark:bg-slate-900">
                <h3 class="text-xl font-bold text-slate-900 dark:text-white">Stress Self-Assessment (PSS-4)</h3>
                <button onclick="document.getElementById('stressModal').classList.add('hidden')"
                    class="text-slate-400 hover:text-slate-600">
                    <span class="material-symbols-outlined">close</span>
                </button>
            </div>
            <div class="p-6" id="stressQuestions">
                <p class="text-sm text-slate-500 mb-6">In the last month, how often have you felt...</p>

                <div class="space-y-6">
                    <div class="stress-q" data-q="1">
                        <p class="font-medium mb-3">1. Unable to control the important things in your life?</p>
                        <div class="flex gap-2 flex-wrap">
                            <button
                                class="stress-opt px-4 py-2 rounded-lg border border-slate-200 dark:border-slate-700 hover:bg-primary hover:text-white hover:border-primary transition-colors"
                                onclick="selectStress(1, 0, this)">Never</button>
                            <button
                                class="stress-opt px-4 py-2 rounded-lg border border-slate-200 dark:border-slate-700 hover:bg-primary hover:text-white hover:border-primary transition-colors"
                                onclick="selectStress(1, 1, this)">Almost Never</button>
                            <button
                                class="stress-opt px-4 py-2 rounded-lg border border-slate-200 dark:border-slate-700 hover:bg-primary hover:text-white hover:border-primary transition-colors"
                                onclick="selectStress(1, 2, this)">Sometimes</button>
                            <button
                                class="stress-opt px-4 py-2 rounded-lg border border-slate-200 dark:border-slate-700 hover:bg-primary hover:text-white hover:border-primary transition-colors"
                                onclick="selectStress(1, 3, this)">Fairly Often</button>
                            <button
                                class="stress-opt px-4 py-2 rounded-lg border border-slate-200 dark:border-slate-700 hover:bg-primary hover:text-white hover:border-primary transition-colors"
                                onclick="selectStress(1, 4, this)">Very Often</button>
                        </div>
                    </div>

                    <div class="stress-q" data-q="2">
                        <p class="font-medium mb-3">2. Confident about your ability to handle personal problems?</p>
                        <div class="flex gap-2 flex-wrap">
                            <button
                                class="stress-opt px-4 py-2 rounded-lg border border-slate-200 dark:border-slate-700 hover:bg-primary hover:text-white hover:border-primary transition-colors"
                                onclick="selectStress(2, 4, this)">Never</button>
                            <button
                                class="stress-opt px-4 py-2 rounded-lg border border-slate-200 dark:border-slate-700 hover:bg-primary hover:text-white hover:border-primary transition-colors"
                                onclick="selectStress(2, 3, this)">Almost Never</button>
                            <button
                                class="stress-opt px-4 py-2 rounded-lg border border-slate-200 dark:border-slate-700 hover:bg-primary hover:text-white hover:border-primary transition-colors"
                                onclick="selectStress(2, 2, this)">Sometimes</button>
                            <button
                                class="stress-opt px-4 py-2 rounded-lg border border-slate-200 dark:border-slate-700 hover:bg-primary hover:text-white hover:border-primary transition-colors"
                                onclick="selectStress(2, 1, this)">Fairly Often</button>
                            <button
                                class="stress-opt px-4 py-2 rounded-lg border border-slate-200 dark:border-slate-700 hover:bg-primary hover:text-white hover:border-primary transition-colors"
                                onclick="selectStress(2, 0, this)">Very Often</button>
                        </div>
                    </div>

                    <div class="stress-q" data-q="3">
                        <p class="font-medium mb-3">3. Things were going your way?</p>
                        <div class="flex gap-2 flex-wrap">
                            <button
                                class="stress-opt px-4 py-2 rounded-lg border border-slate-200 dark:border-slate-700 hover:bg-primary hover:text-white hover:border-primary transition-colors"
                                onclick="selectStress(3, 4, this)">Never</button>
                            <button
                                class="stress-opt px-4 py-2 rounded-lg border border-slate-200 dark:border-slate-700 hover:bg-primary hover:text-white hover:border-primary transition-colors"
                                onclick="selectStress(3, 3, this)">Almost Never</button>
                            <button
                                class="stress-opt px-4 py-2 rounded-lg border border-slate-200 dark:border-slate-700 hover:bg-primary hover:text-white hover:border-primary transition-colors"
                                onclick="selectStress(3, 2, this)">Sometimes</button>
                            <button
                                class="stress-opt px-4 py-2 rounded-lg border border-slate-200 dark:border-slate-700 hover:bg-primary hover:text-white hover:border-primary transition-colors"
                                onclick="selectStress(3, 1, this)">Fairly Often</button>
                            <button
                                class="stress-opt px-4 py-2 rounded-lg border border-slate-200 dark:border-slate-700 hover:bg-primary hover:text-white hover:border-primary transition-colors"
                                onclick="selectStress(3, 0, this)">Very Often</button>
                        </div>
                    </div>

                    <div class="stress-q" data-q="4">
                        <p class="font-medium mb-3">4. Difficulties were piling up so high that you could not overcome
                            them?</p>
                        <div class="flex gap-2 flex-wrap">
                            <button
                                class="stress-opt px-4 py-2 rounded-lg border border-slate-200 dark:border-slate-700 hover:bg-primary hover:text-white hover:border-primary transition-colors"
                                onclick="selectStress(4, 0, this)">Never</button>
                            <button
                                class="stress-opt px-4 py-2 rounded-lg border border-slate-200 dark:border-slate-700 hover:bg-primary hover:text-white hover:border-primary transition-colors"
                                onclick="selectStress(4, 1, this)">Almost Never</button>
                            <button
                                class="stress-opt px-4 py-2 rounded-lg border border-slate-200 dark:border-slate-700 hover:bg-primary hover:text-white hover:border-primary transition-colors"
                                onclick="selectStress(4, 2, this)">Sometimes</button>
                            <button
                                class="stress-opt px-4 py-2 rounded-lg border border-slate-200 dark:border-slate-700 hover:bg-primary hover:text-white hover:border-primary transition-colors"
                                onclick="selectStress(4, 3, this)">Fairly Often</button>
                            <button
                                class="stress-opt px-4 py-2 rounded-lg border border-slate-200 dark:border-slate-700 hover:bg-primary hover:text-white hover:border-primary transition-colors"
                                onclick="selectStress(4, 4, this)">Very Often</button>
                        </div>
                    </div>
                </div>

                <button id="submitStress"
                    class="mt-8 w-full bg-primary text-white font-semibold py-3 rounded-lg hover:bg-indigo-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed"
                    onclick="calculateStress()" disabled>Submit Assessment</button>
            </div>

            <!-- Results -->
            <div id="stressResults" class="hidden p-6">
                <div class="text-center mb-6">
                    <div id="stressScoreCircle"
                        class="w-32 h-32 mx-auto rounded-full flex items-center justify-center text-3xl font-bold text-white mb-4">
                    </div>
                    <h4 id="stressLevel" class="text-xl font-bold"></h4>
                    <p id="stressDesc" class="text-slate-500 mt-2"></p>
                </div>
                <div class="bg-slate-50 dark:bg-slate-800 p-4 rounded-lg">
                    <h5 class="font-semibold mb-2">Recommendations:</h5>
                    <ul id="stressRecs" class="text-sm text-slate-600 dark:text-slate-400 space-y-1"></ul>
                </div>
                <button class="mt-6 w-full bg-primary text-white font-semibold py-3 rounded-lg hover:bg-indigo-700"
                    onclick="document.getElementById('stressModal').classList.add('hidden'); resetStressTest()">Close</button>
            </div>
        </div>
    </div>

    <!-- Success Toast -->
    <div id="successToast"
        class="hidden fixed bottom-4 right-4 bg-green-500 text-white px-6 py-3 rounded-lg shadow-lg flex items-center gap-2 z-50">
        <span class="material-symbols-outlined">check_circle</span>
        <span id="toastMessage">Mood logged!</span>
    </div>

    <script>
        let selectedMood = null;
        let stressScores = {};

        const moodLabels = { 1: 'Terrible ğŸ˜”', 2: 'Bad ğŸ˜Ÿ', 3: 'Okay ğŸ˜', 4: 'Good ğŸ™‚', 5: 'Great ğŸ˜„' };
        const moodEmojis = { 1: 'ğŸ˜”', 2: 'ğŸ˜Ÿ', 3: 'ğŸ˜', 4: 'ğŸ™‚', 5: 'ğŸ˜„' };
        const moodColors = { 1: 'bg-red-400', 2: 'bg-orange-400', 3: 'bg-yellow-400', 4: 'bg-teal-400', 5: 'bg-green-400' };

        function selectMood(mood, btn) {
            selectedMood = mood;
            document.querySelectorAll('.mood-btn').forEach(b => b.classList.remove('ring-4', 'ring-primary', 'ring-offset-2'));
            btn.classList.add('ring-4', 'ring-primary', 'ring-offset-2');
            document.getElementById('selectedMoodText').classList.remove('hidden');
            document.getElementById('moodLabel').textContent = moodLabels[mood];
            document.getElementById('logMoodBtn').disabled = false;
        }

        function logMood() {
            if (!selectedMood) return;

            const today = document.getElementById('todayMood');
            const bar = today.querySelector('div');
            const emoji = today.querySelector('span:first-of-type');

            bar.className = `w-full ${moodColors[selectedMood]} rounded-t-lg transition-all`;
            bar.style.height = (selectedMood * 20) + '%';
            emoji.textContent = moodEmojis[selectedMood];

            showToast('Mood logged successfully! Keep up the streak ğŸ”¥');
            document.getElementById('logMoodBtn').disabled = true;
            document.getElementById('logMoodBtn').textContent = 'Mood Logged âœ“';
        }

        function selectStress(q, score, btn) {
            stressScores[q] = score;
            const qDiv = btn.closest('.stress-q');
            qDiv.querySelectorAll('.stress-opt').forEach(b => {
                b.classList.remove('bg-primary', 'text-white', 'border-primary');
            });
            btn.classList.add('bg-primary', 'text-white', 'border-primary');

            if (Object.keys(stressScores).length === 4) {
                document.getElementById('submitStress').disabled = false;
            }
        }

        function calculateStress() {
            const total = Object.values(stressScores).reduce((a, b) => a + b, 0);
            let level, desc, color, recs;

            if (total <= 5) {
                level = 'Low Stress';
                desc = 'You\'re managing stress well. Keep up the good work!';
                color = 'bg-green-500';
                recs = ['Continue your current coping strategies', 'Practice mindfulness daily', 'Maintain healthy sleep habits'];
            } else if (total <= 10) {
                level = 'Moderate Stress';
                desc = 'You\'re experiencing some stress. Consider trying relaxation techniques.';
                color = 'bg-yellow-500';
                recs = ['Try deep breathing exercises', 'Take regular breaks from work', 'Talk to friends or family', 'Consider our Learning modules on stress management'];
            } else {
                level = 'High Stress';
                desc = 'Your stress levels are elevated. We recommend seeking support.';
                color = 'bg-red-500';
                recs = ['Schedule a counseling appointment', 'Use the Emergency Help resources if needed', 'Practice the grounding techniques in our Resources', 'Prioritize self-care activities'];
            }

            document.getElementById('stressQuestions').classList.add('hidden');
            document.getElementById('stressResults').classList.remove('hidden');
            document.getElementById('stressScoreCircle').className = `w-32 h-32 mx-auto rounded-full flex items-center justify-center text-3xl font-bold text-white mb-4 ${color}`;
            document.getElementById('stressScoreCircle').textContent = total + '/16';
            document.getElementById('stressLevel').textContent = level;
            document.getElementById('stressDesc').textContent = desc;
            document.getElementById('stressRecs').innerHTML = recs.map(r => `<li>â€¢ ${r}</li>`).join('');
        }

        function resetStressTest() {
            stressScores = {};
            document.getElementById('stressQuestions').classList.remove('hidden');
            document.getElementById('stressResults').classList.add('hidden');
            document.getElementById('submitStress').disabled = true;
            document.querySelectorAll('.stress-opt').forEach(b => {
                b.classList.remove('bg-primary', 'text-white', 'border-primary');
            });
        }

        function showToast(message) {
            const toast = document.getElementById('successToast');
            document.getElementById('toastMessage').textContent = message;
            toast.classList.remove('hidden');
            setTimeout(() => toast.classList.add('hidden'), 3000);
        }
    </script>
</body>

</html>