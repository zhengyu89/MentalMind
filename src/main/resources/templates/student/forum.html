<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<head th:replace="~{fragments/layout :: head('Peer Support Forum - MindWell')}">
</head>

<body class="bg-background-light dark:bg-background-dark font-display text-slate-700 dark:text-slate-300 antialiased">
    <div class="flex h-screen">
        <div th:replace="~{fragments/sidebar-student :: sidebar('forum')}"></div>

        <main class="flex-1 p-8 overflow-y-auto">
            <header class="flex justify-between items-start mb-8">
                <div>
                    <h2 class="text-3xl font-bold text-slate-900 dark:text-white">Peer Support Forum</h2>
                    <p class="text-slate-500 dark:text-slate-400 mt-1">Share your thoughts anonymously and support each
                        other.</p>
                </div>
                <button
                    class="flex items-center gap-2 bg-primary text-white font-semibold px-5 py-3 rounded-lg hover:bg-indigo-700 transition-colors"
                    onclick="document.getElementById('newPostModal').classList.remove('hidden')">
                    <span class="material-symbols-outlined">add</span>
                    New Post
                </button>
            </header>

            <!-- Forum Topics/Tabs -->
            <div class="flex gap-2 mb-6 overflow-x-auto pb-2">
                <button class="px-4 py-2 bg-primary text-white rounded-full font-medium whitespace-nowrap"
                    onclick="filterPosts('all')">All Topics</button>
                <button
                    class="px-4 py-2 bg-white dark:bg-slate-900 border border-slate-200 dark:border-slate-800 rounded-full font-medium whitespace-nowrap hover:bg-slate-50 dark:hover:bg-slate-800"
                    onclick="filterPosts('anxiety')">Anxiety</button>
                <button
                    class="px-4 py-2 bg-white dark:bg-slate-900 border border-slate-200 dark:border-slate-800 rounded-full font-medium whitespace-nowrap hover:bg-slate-50 dark:hover:bg-slate-800"
                    onclick="filterPosts('stress')">Stress</button>
                <button
                    class="px-4 py-2 bg-white dark:bg-slate-900 border border-slate-200 dark:border-slate-800 rounded-full font-medium whitespace-nowrap hover:bg-slate-50 dark:hover:bg-slate-800"
                    onclick="filterPosts('depression')">Depression</button>
                <button
                    class="px-4 py-2 bg-white dark:bg-slate-900 border border-slate-200 dark:border-slate-800 rounded-full font-medium whitespace-nowrap hover:bg-slate-50 dark:hover:bg-slate-800"
                    onclick="filterPosts('academic')">Academic</button>
            </div>

            <!-- Posts List -->
            <div id="postsList" class="space-y-4">
                <!-- Post 1 -->
                <div class="bg-white dark:bg-slate-900 p-6 rounded-xl border border-slate-200 dark:border-slate-800"
                    data-topic="anxiety" id="post-1">
                    <div class="flex items-start gap-4">
                        <div
                            class="w-10 h-10 bg-gradient-to-br from-purple-400 to-indigo-500 rounded-full flex items-center justify-center text-white font-bold">
                            A</div>
                        <div class="flex-1">
                            <div class="flex items-center gap-2 mb-2">
                                <span class="font-semibold text-slate-900 dark:text-white">Anonymous</span>
                                <span class="text-xs text-slate-400">â€¢ 2 hours ago</span>
                                <span
                                    class="text-xs font-semibold text-purple-600 bg-purple-100 dark:bg-purple-900/50 px-2 py-0.5 rounded-full">Anxiety</span>
                            </div>
                            <h4 class="text-lg font-semibold text-slate-800 dark:text-white mb-2">Struggling with exam
                                anxiety</h4>
                            <p class="text-slate-600 dark:text-slate-400">Finals are coming up and I can't stop
                                worrying. I've tried studying but my mind just goes blank when I think about the exams.
                                Does anyone have tips for managing test anxiety?</p>
                            <div class="flex items-center gap-6 mt-4">
                                <button
                                    class="like-btn flex items-center gap-1 text-slate-500 hover:text-red-500 transition-colors"
                                    onclick="toggleLike(this)">
                                    <span class="material-symbols-outlined text-xl">favorite</span>
                                    <span class="like-count">12</span>
                                </button>
                                <button
                                    class="flex items-center gap-1 text-slate-500 hover:text-primary transition-colors"
                                    onclick="toggleComments('post-1')">
                                    <span class="material-symbols-outlined text-xl">chat_bubble</span>
                                    <span class="comment-count">5</span> replies
                                </button>
                                <button
                                    class="flex items-center gap-1 text-slate-500 hover:text-red-500 transition-colors ml-auto"
                                    onclick="reportPost('post-1')">
                                    <span class="material-symbols-outlined text-xl">flag</span>
                                    <span class="text-sm">Report</span>
                                </button>
                            </div>
                            <!-- Comments Section -->
                            <div id="comments-post-1"
                                class="hidden mt-4 pt-4 border-t border-slate-200 dark:border-slate-700 space-y-3">
                                <div class="bg-slate-50 dark:bg-slate-800 p-3 rounded-lg">
                                    <div class="flex items-center gap-2 mb-1">
                                        <span class="font-medium text-sm">Nurul Aisyah</span>
                                        <span class="text-xs text-slate-400">â€¢ 1 hour ago</span>
                                    </div>
                                    <p class="text-sm text-slate-600 dark:text-slate-400">Try the 5-4-3-2-1 grounding
                                        technique! It helped me so much during my finals last semester.</p>
                                </div>
                                <div class="bg-slate-50 dark:bg-slate-800 p-3 rounded-lg">
                                    <div class="flex items-center gap-2 mb-1">
                                        <span class="font-medium text-sm">Anonymous</span>
                                        <span class="text-xs text-slate-400">â€¢ 30 mins ago</span>
                                    </div>
                                    <p class="text-sm text-slate-600 dark:text-slate-400">I use the Pomodoro technique -
                                        25 mins study, 5 mins break. Really helps with focus!</p>
                                </div>
                                <div class="flex gap-2 mt-3">
                                    <input type="text" placeholder="Write a supportive comment..."
                                        class="flex-1 px-3 py-2 text-sm bg-white dark:bg-slate-900 border border-slate-200 dark:border-slate-700 rounded-lg focus:ring-primary focus:border-primary" />
                                    <button
                                        class="px-4 py-2 bg-primary text-white text-sm font-medium rounded-lg hover:bg-indigo-700"
                                        onclick="addComment('post-1', this)">Reply</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Post 2 -->
                <div class="bg-white dark:bg-slate-900 p-6 rounded-xl border border-slate-200 dark:border-slate-800"
                    data-topic="academic" id="post-2">
                    <div class="flex items-start gap-4">
                        <div
                            class="w-10 h-10 bg-gradient-to-br from-teal-400 to-green-500 rounded-full flex items-center justify-center text-white font-bold">
                            F</div>
                        <div class="flex-1">
                            <div class="flex items-center gap-2 mb-2">
                                <span class="font-semibold text-slate-900 dark:text-white">Anonymous</span>
                                <span class="text-xs text-slate-400">â€¢ 5 hours ago</span>
                                <span
                                    class="text-xs font-semibold text-teal-600 bg-teal-100 dark:bg-teal-900/50 px-2 py-0.5 rounded-full">Academic</span>
                            </div>
                            <h4 class="text-lg font-semibold text-slate-800 dark:text-white mb-2">Feeling overwhelmed
                                with assignments</h4>
                            <p class="text-slate-600 dark:text-slate-400">I have 4 assignments due next week and I don't
                                know where to start. The workload feels impossible and I'm losing motivation. Any advice
                                on time management?</p>
                            <div class="flex items-center gap-6 mt-4">
                                <button
                                    class="like-btn flex items-center gap-1 text-slate-500 hover:text-red-500 transition-colors"
                                    onclick="toggleLike(this)">
                                    <span class="material-symbols-outlined text-xl">favorite</span>
                                    <span class="like-count">8</span>
                                </button>
                                <button
                                    class="flex items-center gap-1 text-slate-500 hover:text-primary transition-colors"
                                    onclick="toggleComments('post-2')">
                                    <span class="material-symbols-outlined text-xl">chat_bubble</span>
                                    <span class="comment-count">3</span> replies
                                </button>
                                <button
                                    class="flex items-center gap-1 text-slate-500 hover:text-red-500 transition-colors ml-auto"
                                    onclick="reportPost('post-2')">
                                    <span class="material-symbols-outlined text-xl">flag</span>
                                    <span class="text-sm">Report</span>
                                </button>
                            </div>
                            <!-- Comments Section -->
                            <div id="comments-post-2"
                                class="hidden mt-4 pt-4 border-t border-slate-200 dark:border-slate-700 space-y-3">
                                <div class="bg-slate-50 dark:bg-slate-800 p-3 rounded-lg">
                                    <div class="flex items-center gap-2 mb-1">
                                        <span class="font-medium text-sm">Hafiz Rahman</span>
                                        <span class="text-xs text-slate-400">â€¢ 3 hours ago</span>
                                    </div>
                                    <p class="text-sm text-slate-600 dark:text-slate-400">Break it down into smaller
                                        tasks, bro. One step at a time. You got this! ðŸ’ª</p>
                                </div>
                                <div class="flex gap-2 mt-3">
                                    <input type="text" placeholder="Write a supportive comment..."
                                        class="flex-1 px-3 py-2 text-sm bg-white dark:bg-slate-900 border border-slate-200 dark:border-slate-700 rounded-lg focus:ring-primary focus:border-primary" />
                                    <button
                                        class="px-4 py-2 bg-primary text-white text-sm font-medium rounded-lg hover:bg-indigo-700"
                                        onclick="addComment('post-2', this)">Reply</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Post 3 -->
                <div class="bg-white dark:bg-slate-900 p-6 rounded-xl border border-slate-200 dark:border-slate-800"
                    data-topic="stress" id="post-3">
                    <div class="flex items-start gap-4">
                        <div
                            class="w-10 h-10 bg-gradient-to-br from-amber-400 to-orange-500 rounded-full flex items-center justify-center text-white font-bold">
                            S</div>
                        <div class="flex-1">
                            <div class="flex items-center gap-2 mb-2">
                                <span class="font-semibold text-slate-900 dark:text-white">Anonymous</span>
                                <span class="text-xs text-slate-400">â€¢ 1 day ago</span>
                                <span
                                    class="text-xs font-semibold text-amber-600 bg-amber-100 dark:bg-amber-900/50 px-2 py-0.5 rounded-full">Stress</span>
                            </div>
                            <h4 class="text-lg font-semibold text-slate-800 dark:text-white mb-2">Small wins
                                appreciation post ðŸŽ‰</h4>
                            <p class="text-slate-600 dark:text-slate-400">I finally managed to go to bed before midnight
                                for 3 days straight! It's a small victory but I'm proud of myself. Remember to celebrate
                                your small wins too!</p>
                            <div class="flex items-center gap-6 mt-4">
                                <button class="like-btn liked flex items-center gap-1 text-red-500 transition-colors"
                                    onclick="toggleLike(this)">
                                    <span class="material-symbols-outlined text-xl filled">favorite</span>
                                    <span class="like-count">45</span>
                                </button>
                                <button
                                    class="flex items-center gap-1 text-slate-500 hover:text-primary transition-colors"
                                    onclick="toggleComments('post-3')">
                                    <span class="material-symbols-outlined text-xl">chat_bubble</span>
                                    <span class="comment-count">12</span> replies
                                </button>
                                <button
                                    class="flex items-center gap-1 text-slate-500 hover:text-red-500 transition-colors ml-auto"
                                    onclick="reportPost('post-3')">
                                    <span class="material-symbols-outlined text-xl">flag</span>
                                    <span class="text-sm">Report</span>
                                </button>
                            </div>
                            <!-- Comments Section -->
                            <div id="comments-post-3"
                                class="hidden mt-4 pt-4 border-t border-slate-200 dark:border-slate-700 space-y-3">
                                <div class="bg-slate-50 dark:bg-slate-800 p-3 rounded-lg">
                                    <div class="flex items-center gap-2 mb-1">
                                        <span class="font-medium text-sm">Siti Aminah</span>
                                        <span class="text-xs text-slate-400">â€¢ 20 hours ago</span>
                                    </div>
                                    <p class="text-sm text-slate-600 dark:text-slate-400">Congrats! ðŸŽŠ Sleep is so
                                        important. Proud of you!</p>
                                </div>
                                <div class="bg-slate-50 dark:bg-slate-800 p-3 rounded-lg">
                                    <div class="flex items-center gap-2 mb-1">
                                        <span class="font-medium text-sm">Muhammad Irfan</span>
                                        <span class="text-xs text-slate-400">â€¢ 18 hours ago</span>
                                    </div>
                                    <p class="text-sm text-slate-600 dark:text-slate-400">This is inspiring! Going to
                                        try this too ðŸ’¯</p>
                                </div>
                                <div class="flex gap-2 mt-3">
                                    <input type="text" placeholder="Write a supportive comment..."
                                        class="flex-1 px-3 py-2 text-sm bg-white dark:bg-slate-900 border border-slate-200 dark:border-slate-700 rounded-lg focus:ring-primary focus:border-primary" />
                                    <button
                                        class="px-4 py-2 bg-primary text-white text-sm font-medium rounded-lg hover:bg-indigo-700"
                                        onclick="addComment('post-3', this)">Reply</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- New Post Modal -->
    <div id="newPostModal" class="hidden fixed inset-0 bg-black/50 flex items-center justify-center p-4 z-50">
        <div class="bg-white dark:bg-slate-900 rounded-xl w-full max-w-lg">
            <div class="p-6 border-b border-slate-200 dark:border-slate-800 flex justify-between items-center">
                <h3 class="text-xl font-bold text-slate-900 dark:text-white">Create Anonymous Post</h3>
                <button onclick="document.getElementById('newPostModal').classList.add('hidden')"
                    class="text-slate-400 hover:text-slate-600">
                    <span class="material-symbols-outlined">close</span>
                </button>
            </div>
            <form class="p-6" onsubmit="createPost(event)">
                <div class="mb-4">
                    <label class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2">Topic</label>
                    <select id="postTopic"
                        class="w-full px-4 py-2 bg-slate-100 dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded-lg focus:ring-primary focus:border-primary">
                        <option value="anxiety">Anxiety</option>
                        <option value="stress">Stress</option>
                        <option value="depression">Depression</option>
                        <option value="academic">Academic</option>
                    </select>
                </div>
                <div class="mb-4">
                    <label class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2">Title</label>
                    <input type="text" id="postTitle" placeholder="Give your post a title..."
                        class="w-full px-4 py-2 bg-slate-100 dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded-lg focus:ring-primary focus:border-primary"
                        required />
                </div>
                <div class="mb-6">
                    <label class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2">Content</label>
                    <textarea id="postContent" rows="4" placeholder="Share your thoughts..."
                        class="w-full px-4 py-2 bg-slate-100 dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded-lg focus:ring-primary focus:border-primary"
                        required></textarea>
                </div>
                <div class="flex items-center gap-2 text-sm text-slate-500 mb-6">
                    <span class="material-symbols-outlined text-base">visibility_off</span>
                    Your identity will remain anonymous
                </div>
                <button type="submit"
                    class="w-full bg-primary text-white font-semibold py-3 rounded-lg hover:bg-indigo-700 transition-colors">Post
                    Anonymously</button>
            </form>
        </div>
    </div>

    <!-- Success Toast -->
    <div id="successToast"
        class="hidden fixed bottom-4 right-4 bg-green-500 text-white px-6 py-3 rounded-lg shadow-lg flex items-center gap-2 z-50">
        <span class="material-symbols-outlined">check_circle</span>
        <span id="toastMessage">Action completed!</span>
    </div>

    <script>
        // Toggle like
        function toggleLike(btn) {
            const countSpan = btn.querySelector('.like-count');
            const icon = btn.querySelector('.material-symbols-outlined');
            let count = parseInt(countSpan.textContent);

            if (btn.classList.contains('liked')) {
                btn.classList.remove('liked', 'text-red-500');
                btn.classList.add('text-slate-500');
                icon.classList.remove('filled');
                countSpan.textContent = count - 1;
            } else {
                btn.classList.add('liked', 'text-red-500');
                btn.classList.remove('text-slate-500');
                icon.classList.add('filled');
                countSpan.textContent = count + 1;
            }
        }

        // Toggle comments
        function toggleComments(postId) {
            const comments = document.getElementById('comments-' + postId);
            comments.classList.toggle('hidden');
        }

        // Add comment
        function addComment(postId, btn) {
            const input = btn.previousElementSibling;
            const text = input.value.trim();
            if (!text) return;

            const commentsDiv = document.getElementById('comments-' + postId);
            const inputDiv = commentsDiv.querySelector('.flex.gap-2');

            const newComment = document.createElement('div');
            newComment.className = 'bg-slate-50 dark:bg-slate-800 p-3 rounded-lg';
            newComment.innerHTML = `
                <div class="flex items-center gap-2 mb-1">
                    <span class="font-medium text-sm">You (Anonymous)</span>
                    <span class="text-xs text-slate-400">â€¢ Just now</span>
                </div>
                <p class="text-sm text-slate-600 dark:text-slate-400">${text}</p>
            `;

            inputDiv.insertAdjacentElement('beforebegin', newComment);
            input.value = '';

            // Update comment count
            const post = document.getElementById(postId);
            const countSpan = post.querySelector('.comment-count');
            countSpan.textContent = parseInt(countSpan.textContent) + 1;

            showToast('Comment posted successfully!');
        }

        // Create new post
        function createPost(e) {
            e.preventDefault();
            const topic = document.getElementById('postTopic').value;
            const title = document.getElementById('postTitle').value;
            const content = document.getElementById('postContent').value;

            const colors = {
                'anxiety': 'from-purple-400 to-indigo-500',
                'stress': 'from-amber-400 to-orange-500',
                'depression': 'from-blue-400 to-cyan-500',
                'academic': 'from-teal-400 to-green-500'
            };
            const tagColors = {
                'anxiety': 'text-purple-600 bg-purple-100 dark:bg-purple-900/50',
                'stress': 'text-amber-600 bg-amber-100 dark:bg-amber-900/50',
                'depression': 'text-blue-600 bg-blue-100 dark:bg-blue-900/50',
                'academic': 'text-teal-600 bg-teal-100 dark:bg-teal-900/50'
            };

            const postId = 'post-' + Date.now();
            const newPost = document.createElement('div');
            newPost.className = 'bg-white dark:bg-slate-900 p-6 rounded-xl border border-slate-200 dark:border-slate-800';
            newPost.setAttribute('data-topic', topic);
            newPost.id = postId;
            newPost.innerHTML = `
                <div class="flex items-start gap-4">
                    <div class="w-10 h-10 bg-gradient-to-br ${colors[topic]} rounded-full flex items-center justify-center text-white font-bold">Y</div>
                    <div class="flex-1">
                        <div class="flex items-center gap-2 mb-2">
                            <span class="font-semibold text-slate-900 dark:text-white">Anonymous (You)</span>
                            <span class="text-xs text-slate-400">â€¢ Just now</span>
                            <span class="text-xs font-semibold ${tagColors[topic]} px-2 py-0.5 rounded-full">${topic.charAt(0).toUpperCase() + topic.slice(1)}</span>
                        </div>
                        <h4 class="text-lg font-semibold text-slate-800 dark:text-white mb-2">${title}</h4>
                        <p class="text-slate-600 dark:text-slate-400">${content}</p>
                        <div class="flex items-center gap-6 mt-4">
                            <button class="like-btn flex items-center gap-1 text-slate-500 hover:text-red-500 transition-colors" onclick="toggleLike(this)">
                                <span class="material-symbols-outlined text-xl">favorite</span>
                                <span class="like-count">0</span>
                            </button>
                            <button class="flex items-center gap-1 text-slate-500 hover:text-primary transition-colors" onclick="toggleComments('${postId}')">
                                <span class="material-symbols-outlined text-xl">chat_bubble</span>
                                <span class="comment-count">0</span> replies
                            </button>
                        </div>
                        <div id="comments-${postId}" class="hidden mt-4 pt-4 border-t border-slate-200 dark:border-slate-700 space-y-3">
                            <div class="flex gap-2 mt-3">
                                <input type="text" placeholder="Write a supportive comment..." class="flex-1 px-3 py-2 text-sm bg-white dark:bg-slate-900 border border-slate-200 dark:border-slate-700 rounded-lg focus:ring-primary focus:border-primary"/>
                                <button class="px-4 py-2 bg-primary text-white text-sm font-medium rounded-lg hover:bg-indigo-700" onclick="addComment('${postId}', this)">Reply</button>
                            </div>
                        </div>
                    </div>
                </div>
            `;

            document.getElementById('postsList').insertBefore(newPost, document.getElementById('postsList').firstChild);
            document.getElementById('newPostModal').classList.add('hidden');
            document.getElementById('postTitle').value = '';
            document.getElementById('postContent').value = '';

            showToast('Post created successfully!');
        }

        // Report post
        function reportPost(postId) {
            showToast('Post reported. Our team will review it.');
        }

        // Filter posts
        function filterPosts(topic) {
            const posts = document.querySelectorAll('#postsList > div');
            posts.forEach(post => {
                if (topic === 'all' || post.dataset.topic === topic) {
                    post.style.display = '';
                } else {
                    post.style.display = 'none';
                }
            });
        }

        // Show toast
        function showToast(message) {
            const toast = document.getElementById('successToast');
            document.getElementById('toastMessage').textContent = message;
            toast.classList.remove('hidden');
            setTimeout(() => toast.classList.add('hidden'), 3000);
        }
    </script>
</body>

</html>