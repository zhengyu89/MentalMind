<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<head th:replace="~{fragments/layout :: head('Add Learning Material')}">
</head>

<body class="font-display bg-background-light dark:bg-background-dark text-text-primary-light dark:text-text-primary-dark transition-colors duration-300">
    <!-- TinyMCE Editor -->
    <script th:src="'https://cdn.tiny.cloud/1/' + ${@environment.getProperty('tinymce.api.key')} + '/tinymce/6/tinymce.min.js'" referrerpolicy="origin"></script>
    <div class="flex h-screen">
        <div th:replace="~{fragments/sidebar-counselor :: sidebar('learning')}"></div>

        <main class="flex-1 overflow-y-auto">
            <header class="h-16 flex items-center justify-between px-8 border-b border-border-light dark:border-border-dark sticky top-0 bg-background-light/80 dark:bg-background-dark/80 backdrop-blur-sm">
                <div>
                    <h2 class="text-2xl font-bold">Add Learning Material</h2>
                    <p class="text-sm text-text-secondary-light dark:text-text-secondary-dark" th:text="'Module: ' + ${module.title}">Module: Name</p>
                </div>
                <a th:href="@{/counselor/learning/module/{moduleId}(moduleId=${module.id})}" class="inline-flex items-center gap-2 px-4 py-2 text-text-secondary-light dark:text-text-secondary-dark hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition">
                    <span class="material-symbols-outlined">arrow_back</span>
                    <span>Back</span>
                </a>
            </header>

            <div class="p-8">
                <div class="max-w-4xl mx-auto">

            <!-- Error Message -->
            <div th:if="${error}" class="mb-6 p-4 rounded-lg bg-red-50 dark:bg-red-900/30 border border-red-200 dark:border-red-800">
                <div class="flex items-center gap-3">
                    <span class="material-symbols-outlined text-red-600 dark:text-red-400">error</span>
                    <p class="text-sm font-medium text-red-800 dark:text-red-300" th:text="${error}">Error message</p>
                </div>
            </div>

            <!-- Material Form -->
            <form th:action="@{/counselor/learning/module/{moduleId}/add-material(moduleId=${module.id})}" method="post" class="space-y-6" onsubmit="prepareFormSubmission()">
                
                <!-- Step 1: Material Title -->
                <div class="bg-white dark:bg-slate-900 rounded-xl shadow-md p-8 border border-slate-200 dark:border-slate-800">
                    <div class="flex items-center gap-3 mb-6">
                        <div class="flex items-center justify-center w-8 h-8 rounded-full bg-primary text-white font-bold">1</div>
                        <h2 class="text-xl font-bold text-slate-800 dark:text-white">Material Title</h2>
                    </div>
                    
                    <div>
                        <label for="materialTitle" class="block text-sm font-medium text-slate-600 dark:text-slate-300 mb-2">
                            Give your material a name <span class="text-red-500">*</span>
                        </label>
                        <input type="text" id="materialTitle" name="materialTitle" required
                            class="w-full px-4 py-3 bg-slate-50 dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent"
                            placeholder="e.g. Introduction to Mental Health, Stress Management Basics">
                        <p class="text-sm text-slate-500 dark:text-slate-400 mt-2">This title will be displayed to students</p>
                    </div>
                </div>

                <!-- Step 2: Material Type Selection -->
                <div class="bg-white dark:bg-slate-900 rounded-xl shadow-md p-8 border border-slate-200 dark:border-slate-800">
                    <div class="flex items-center gap-3 mb-6">
                        <div class="flex items-center justify-center w-8 h-8 rounded-full bg-primary text-white font-bold">2</div>
                        <h2 class="text-xl font-bold text-slate-800 dark:text-white">Select Material Type</h2>
                    </div>
                    
                    <div class="space-y-3">
                        <label class="relative flex items-start p-4 border-2 border-slate-200 dark:border-slate-700 rounded-lg hover:border-primary cursor-pointer transition"
                            onclick="document.getElementById('VIDEO').click()">
                            <input type="radio" id="VIDEO" name="materialType" value="VIDEO" required
                                class="mt-1 w-4 h-4 text-primary">
                            <div class="ml-4 flex-1">
                                <p class="font-semibold text-slate-800 dark:text-white flex items-center gap-2">
                                    <span class="material-symbols-outlined text-red-500">play_circle</span>
                                    Video Link
                                </p>
                                <p class="text-sm text-slate-500 dark:text-slate-400 mt-1">Embed YouTube or video URLs for students to watch</p>
                            </div>
                        </label>

                        <label class="relative flex items-start p-4 border-2 border-slate-200 dark:border-slate-700 rounded-lg hover:border-primary cursor-pointer transition"
                            onclick="document.getElementById('DOCUMENT').click()">
                            <input type="radio" id="DOCUMENT" name="materialType" value="DOCUMENT" required
                                class="mt-1 w-4 h-4 text-primary">
                            <div class="ml-4 flex-1">
                                <p class="font-semibold text-slate-800 dark:text-white flex items-center gap-2">
                                    <span class="material-symbols-outlined text-blue-500">description</span>
                                    Reading Document
                                </p>
                                <p class="text-sm text-slate-500 dark:text-slate-400 mt-1">Create rich text content with formatting, images, and links</p>
                            </div>
                        </label>

                        <label class="relative flex items-start p-4 border-2 border-slate-200 dark:border-slate-700 rounded-lg hover:border-primary cursor-pointer transition opacity-50 pointer-events-none"
                            onclick="document.getElementById('QUIZ').click()">
                            <input type="radio" id="QUIZ" name="materialType" value="QUIZ" disabled
                                class="mt-1 w-4 h-4 text-primary">
                            <div class="ml-4 flex-1">
                                <p class="font-semibold text-slate-800 dark:text-white flex items-center gap-2">
                                    <span class="material-symbols-outlined text-green-500">quiz</span>
                                    Quiz
                                </p>
                                <p class="text-sm text-slate-500 dark:text-slate-400 mt-1">Create interactive quizzes (Coming Soon)</p>
                            </div>
                        </label>
                    </div>
                </div>

                <!-- Step 3: Material Content -->
                <div id="contentSection" class="bg-white dark:bg-slate-900 rounded-xl shadow-md p-8 border border-slate-200 dark:border-slate-800">
                    <div class="flex items-center gap-3 mb-6">
                        <div class="flex items-center justify-center w-8 h-8 rounded-full bg-primary text-white font-bold">3</div>
                        <h2 class="text-xl font-bold text-slate-800 dark:text-white">Material Content</h2>
                    </div>

                    <!-- Video Content -->
                    <div id="videoContent" class="hidden">
                        <label for="videoMaterialContent" class="block text-sm font-medium text-slate-600 dark:text-slate-300 mb-2">
                            Video URL <span class="text-red-500">*</span>
                        </label>
                        <input type="url" id="videoMaterialContent" name="materialContent"
                            class="w-full px-4 py-3 bg-slate-50 dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent"
                            placeholder="https://www.youtube.com/embed/dQw4w9WgXcQ">
                        <p class="text-sm text-slate-500 dark:text-slate-400 mt-2">
                            Paste the full YouTube embed URL or video link
                        </p>
                    </div>

                    <!-- Document Content -->
                    <div id="documentContent" class="hidden">
                        <label for="documentMaterialContent" class="block text-sm font-medium text-slate-600 dark:text-slate-300 mb-2">
                            Document Content <span class="text-red-500">*</span>
                        </label>
                        <textarea id="documentMaterialContent" name="materialContent" rows="10"
                            class="w-full px-4 py-3 bg-slate-50 dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent font-mono text-sm"
                            placeholder="Use the editor below to format your content. You can add text, lists, links, and more."></textarea>
                        <p class="text-sm text-slate-500 dark:text-slate-400 mt-2">
                            Use the toolbar above to format your content. No HTML knowledge needed!
                        </p>
                    </div>
                </div>

                <!-- Submit Button -->
                <div class="flex gap-4">
                    <a th:href="@{/counselor/learning/module/{moduleId}(moduleId=${module.id})}"
                        class="flex-1 inline-flex items-center justify-center px-6 py-3 border-2 border-slate-300 dark:border-slate-700 text-slate-800 dark:text-white font-semibold rounded-lg hover:bg-slate-50 dark:hover:bg-slate-800 transition">
                        Cancel
                    </a>
                    <button type="submit"
                        class="flex-1 inline-flex items-center justify-center gap-2 px-6 py-3 bg-primary text-white font-semibold rounded-lg hover:bg-primary/90 transition">
                        <span class="material-symbols-outlined">add_circle</span>
                        <span>Add Material</span>
                    </button>
                </div>
            </form>
        </div>
    </main>

    <script>
        const radioButtons = document.querySelectorAll('input[name="materialType"]');
        const videoContent = document.getElementById('videoContent');
        const documentContent = document.getElementById('documentContent');
        let editorInitialized = false;

        function updateContentSection() {
            const selectedType = document.querySelector('input[name="materialType"]:checked')?.value;
            const videoInput = document.getElementById('videoMaterialContent');
            const documentTextarea = document.getElementById('documentMaterialContent');
            
            videoContent.classList.add('hidden');
            documentContent.classList.add('hidden');
            
            // Remove required from all inputs
            videoInput.removeAttribute('required');
            if (tinymce.get('documentMaterialContent')) {
                tinymce.get('documentMaterialContent').setRequiredLevel(false);
            } else {
                documentTextarea.removeAttribute('required');
            }
            
            if (selectedType === 'VIDEO') {
                videoContent.classList.remove('hidden');
                videoInput.setAttribute('required', 'required');
            } else if (selectedType === 'DOCUMENT') {
                documentContent.classList.remove('hidden');
                if (!editorInitialized) {
                    initializeTinyMCE();
                    editorInitialized = true;
                }
                if (tinymce.get('documentMaterialContent')) {
                    tinymce.get('documentMaterialContent').setRequiredLevel(true);
                } else {
                    documentTextarea.setAttribute('required', 'required');
                }
            }
        }

        function initializeTinyMCE() {
            tinymce.init({
                selector: '#documentMaterialContent',
                plugins: 'lists link image table code',
                toolbar: 'undo redo | formatselect | bold italic underline strikethrough | alignleft aligncenter alignright alignjustify | bullist numlist | link image table | code',
                menubar: false,
                height: 300,
                skin: 'oxide-dark',
                content_css: 'dark',
                promotion: false,
                branding: false
            });
        }

        function prepareFormSubmission() {
            const videoInput = document.getElementById('videoMaterialContent');
            const documentTextarea = document.getElementById('documentMaterialContent');
            
            // Clear name attribute from hidden inputs to prevent submission
            if (videoContent.classList.contains('hidden')) {
                videoInput.removeAttribute('name');
            } else {
                documentTextarea.removeAttribute('name');
            }
            
            return true;
        }

        radioButtons.forEach(radio => {
            radio.addEventListener('change', updateContentSection);
        });

        // Initial update
        updateContentSection();
    </script>
                </div>
            </div>
        </main>
    </div>
</body>

</html>
